#!/bin/bash

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘  Beautifulconfig v2.1 for Runget (KDE Plasma Support)             â•‘
# â•‘  Created by kirilldual0987 Â© 2025                                 â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VERSION="2.1"
AUTHOR="kirilldual0987"
YEAR="2025"

# URL Ğ¾Ğ±Ğ¾ĞµĞ² Ñ Google Drive
WALLPAPER_URL="https://drive.usercontent.google.com/u/0/uc?id=1DMUeoRB3fMxzBVo33jyiKJCCctfCTPXb&export=download"
WALLPAPER_DIR="$HOME/.local/share/wallpapers/Beautifulconfig"
WALLPAPER_FILE="$WALLPAPER_DIR/wallpaper.jpg"

# Ğ›Ğ¾Ğ³ Ñ„Ğ°Ğ¹Ğ»
LOG_FILE="/tmp/beautifulconfig_$(date +%Y%m%d_%H%M%S).log"

#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Ğ¦Ğ’Ğ•Ğ¢Ğ Ğ˜ Ğ¡Ğ¢Ğ˜Ğ›Ğ˜
#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
GRAY='\033[0;90m'
BOLD='\033[1m'
ITALIC='\033[3m'
NC='\033[0m'

DONE="âœ…"
FAIL="âŒ"
WARN="âš ï¸"
INFO="â„¹ï¸"
ARROW="â¤"
GEAR="âš™"
DOWNLOAD="â¬‡"
ROCKET="ğŸš€"
STAR="â˜…"

#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜ Ğ˜ĞĞ¢Ğ•Ğ Ğ¤Ğ•Ğ™Ğ¡Ğ
#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

clear_screen() {
    clear
    printf '\033[3J'
}

show_banner() {
    clear_screen
    echo -e "${CYAN}${BOLD}"
    cat << 'EOF'
    
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘                                                                   â•‘
    â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—  â•‘
    â•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â•‘
    â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘  â•‘
    â•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•  â•‘
    â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘      â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•   â•‘
    â•‘   â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â•    â•šâ•â•   â•šâ•â•â•šâ•â•       â•šâ•â•â•â•    â•‘
    â•‘                                                                   â•‘
    â•‘              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—        â•‘
    â•‘             â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•        â•‘
    â•‘             â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—       â•‘
    â•‘             â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘       â•‘
    â•‘             â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•       â•‘
    â•‘              â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•â•â•â•šâ•â•     â•šâ•â• â•šâ•â•â•â•â•â•        â•‘
    â•‘                                                                   â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
EOF
    echo -e "${NC}"
    echo -e "${PURPLE}${BOLD}                   Version ${VERSION} | Created by ${AUTHOR} Â© ${YEAR}${NC}"
    echo -e "${GRAY}                         Designed for Runget Linux (KDE Plasma)${NC}"
    echo ""
    sleep 1
}

animated_line() {
    local width=65
    echo -ne "${CYAN}"
    for ((i=0; i<width; i++)); do
        echo -n "â”"
        sleep 0.01
    done
    echo -e "${NC}"
}

terminal_progress_bar() {
    local current=$1
    local total=$2
    local task_name="$3"
    local width=50
    local percentage=$((current * 100 / total))
    local filled=$((width * current / total))
    local empty=$((width - filled))
    
    local color=$RED
    if [ $percentage -ge 75 ]; then
        color=$GREEN
    elif [ $percentage -ge 50 ]; then
        color=$YELLOW
    elif [ $percentage -ge 25 ]; then
        color=$CYAN
    fi
    
    printf "\r    ${WHITE}${BOLD}[${NC}"
    printf "${color}"
    for ((i=0; i<filled; i++)); do printf "â–ˆ"; done
    printf "${GRAY}"
    for ((i=0; i<empty; i++)); do printf "â–‘"; done
    printf "${NC}${WHITE}${BOLD}]${NC}"
    printf " ${color}${BOLD}%3d%%${NC}" $percentage
    printf " ${GRAY}â”‚${NC} ${WHITE}${task_name}${NC}"
    printf "%-20s" ""
}

print_status() {
    local type=$1
    local message="$2"
    
    case $type in
        "info")
            echo -e "    ${BLUE}${INFO}${NC}  ${WHITE}${message}${NC}"
            ;;
        "success")
            echo -e "    ${GREEN}${DONE}${NC} ${GREEN}${message}${NC}"
            ;;
        "error")
            echo -e "    ${RED}${FAIL}${NC} ${RED}${message}${NC}"
            ;;
        "warning")
            echo -e "    ${YELLOW}${WARN}${NC}  ${YELLOW}${message}${NC}"
            ;;
        "task")
            echo -e "    ${PURPLE}${ARROW}${NC}  ${BOLD}${message}${NC}"
            ;;
        "command")
            echo -e "       ${GRAY}â””â”€ Command: ${ITALIC}${message}${NC}"
            ;;
    esac
}

section_divider() {
    local title="$1"
    echo ""
    echo -e "${CYAN}    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”${NC}"
    echo -e "${CYAN}    â”‚${NC} ${BOLD}${WHITE}${GEAR} ${title}${NC}"
    echo -e "${CYAN}    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜${NC}"
    echo ""
}

#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ĞĞŸĞ Ğ•Ğ”Ğ•Ğ›Ğ•ĞĞ˜Ğ• ĞĞšĞ Ğ£Ğ–Ğ•ĞĞ˜Ğ¯ Ğ ĞĞ‘ĞĞ§Ğ•Ğ“Ğ Ğ¡Ğ¢ĞĞ›Ğ
#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

detect_desktop_environment() {
    if [ "$XDG_CURRENT_DESKTOP" = "KDE" ] || [ "$DESKTOP_SESSION" = "plasma" ] || pgrep -x "plasmashell" > /dev/null; then
        echo "kde"
    elif [ "$XDG_CURRENT_DESKTOP" = "GNOME" ] || pgrep -x "gnome-shell" > /dev/null; then
        echo "gnome"
    elif [ "$XDG_CURRENT_DESKTOP" = "XFCE" ]; then
        echo "xfce"
    elif [ "$XDG_CURRENT_DESKTOP" = "MATE" ]; then
        echo "mate"
    elif [ "$XDG_CURRENT_DESKTOP" = "Cinnamon" ]; then
        echo "cinnamon"
    else
        echo "unknown"
    fi
}

#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ ĞĞ‘ĞĞ•Ğ’ Ğ”Ğ›Ğ¯ KDE PLASMA
#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

set_wallpaper_kde() {
    local wallpaper_path="$1"
    
    print_status "task" "ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¾Ğ±Ğ¾ĞµĞ² Ğ´Ğ»Ñ KDE Plasma..."
    
    # ĞœĞµÑ‚Ğ¾Ğ´ 1: plasma-apply-wallpaperimage (Plasma 5.18+)
    if command -v plasma-apply-wallpaperimage &> /dev/null; then
        print_status "info" "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ plasma-apply-wallpaperimage..."
        plasma-apply-wallpaperimage "$wallpaper_path" 2>> "$LOG_FILE"
        if [ $? -eq 0 ]; then
            print_status "success" "ĞĞ±Ğ¾Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ñ‡ĞµÑ€ĞµĞ· plasma-apply-wallpaperimage!"
            return 0
        fi
    fi
    
    # ĞœĞµÑ‚Ğ¾Ğ´ 2: Ñ‡ĞµÑ€ĞµĞ· qdbus
    if command -v qdbus &> /dev/null; then
        print_status "info" "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ qdbus..."
        
        qdbus org.kde.plasmashell /PlasmaShell org.kde.PlasmaShell.evaluateScript "
            var allDesktops = desktops();
            for (var i = 0; i < allDesktops.length; i++) {
                var d = allDesktops[i];
                d.wallpaperPlugin = 'org.kde.image';
                d.currentConfigGroup = Array('Wallpaper', 'org.kde.image', 'General');
                d.writeConfig('Image', 'file://${wallpaper_path}');
            }
        " 2>> "$LOG_FILE"
        
        if [ $? -eq 0 ]; then
            print_status "success" "ĞĞ±Ğ¾Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ñ‡ĞµÑ€ĞµĞ· qdbus!"
            return 0
        fi
    fi
    
    # ĞœĞµÑ‚Ğ¾Ğ´ 3: Ñ‡ĞµÑ€ĞµĞ· dbus-send
    if command -v dbus-send &> /dev/null; then
        print_status "info" "Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ dbus-send..."
        
        dbus-send --session --dest=org.kde.plasmashell --type=method_call \
            /PlasmaShell org.kde.PlasmaShell.evaluateScript string:"
            var allDesktops = desktops();
            for (var i = 0; i < allDesktops.length; i++) {
                var d = allDesktops[i];
                d.wallpaperPlugin = 'org.kde.image';
                d.currentConfigGroup = Array('Wallpaper', 'org.kde.image', 'General');
                d.writeConfig('Image', 'file://${wallpaper_path}');
            }
        " 2>> "$LOG_FILE"
        
        if [ $? -eq 0 ]; then
            print_status "success" "ĞĞ±Ğ¾Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ñ‡ĞµÑ€ĞµĞ· dbus-send!"
            return 0
        fi
    fi
    
    # ĞœĞµÑ‚Ğ¾Ğ´ 4: ĞŸÑ€ÑĞ¼Ğ¾Ğµ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ° (fallback)
    print_status "warning" "ĞŸÑ€Ğ¾Ğ±ÑƒĞµĞ¼ Ğ¿Ñ€ÑĞ¼Ğ¾Ğµ Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ°..."
    
    local plasma_config="$HOME/.config/plasma-org.kde.plasma.desktop-appletsrc"
    
    if [ -f "$plasma_config" ]; then
        # Ğ‘ÑĞºĞ°Ğ¿
        cp "$plasma_config" "${plasma_config}.backup"
        
        # Ğ—Ğ°Ğ¼ĞµĞ½ÑĞµĞ¼ Ğ¿ÑƒÑ‚ÑŒ Ğº Ğ¾Ğ±Ğ¾ÑĞ¼
        sed -i "s|Image=.*|Image=file://${wallpaper_path}|g" "$plasma_config"
        
        # ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞºĞ°ĞµĞ¼ plasmashell
        print_status "info" "ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº plasmashell..."
        kquitapp5 plasmashell 2>> "$LOG_FILE" && kstart5 plasmashell 2>> "$LOG_FILE" &
        
        sleep 3
        print_status "success" "ĞĞ±Ğ¾Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ñ‡ĞµÑ€ĞµĞ· Ñ€ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³Ğ°!"
        return 0
    fi
    
    print_status "error" "ĞĞµ ÑƒĞ´Ğ°Ğ»Ğ¾ÑÑŒ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ±Ğ¾Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸"
    print_status "info" "ĞĞ±Ğ¾Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹: $wallpaper_path"
    print_status "info" "Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ: ĞŸĞšĞœ Ğ½Ğ° Ñ€Ğ°Ğ±Ğ¾Ñ‡ĞµĞ¼ ÑÑ‚Ğ¾Ğ»Ğµ â†’ ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ±Ğ¾Ñ‡Ğ¸Ğ¹ ÑÑ‚Ğ¾Ğ»"
    return 1
}

set_wallpaper_gnome() {
    local wallpaper_path="$1"
    
    print_status "task" "ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ¾Ğ±Ğ¾ĞµĞ² Ğ´Ğ»Ñ GNOME..."
    
    gsettings set org.gnome.desktop.background picture-uri "file://$wallpaper_path" 2>> "$LOG_FILE"
    gsettings set org.gnome.desktop.background picture-uri-dark "file://$wallpaper_path" 2>> "$LOG_FILE"
    gsettings set org.gnome.desktop.background picture-options "zoom" 2>> "$LOG_FILE"
    
    print_status "success" "ĞĞ±Ğ¾Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹ Ğ´Ğ»Ñ GNOME!"
    return 0
}

#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# ĞĞ¡ĞĞĞ’ĞĞ«Ğ• Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ˜
#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

check_dependencies() {
    section_divider "ĞŸĞ ĞĞ’Ğ•Ğ ĞšĞ Ğ—ĞĞ’Ğ˜Ğ¡Ğ˜ĞœĞĞ¡Ğ¢Ğ•Ğ™"
    
    local deps=("curl" "wget")
    local missing=()
    
    # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ kdialog Ğ´Ğ»Ñ KDE Ğ¸Ğ»Ğ¸ zenity Ğ´Ğ»Ñ Ğ´Ñ€ÑƒĞ³Ğ¸Ñ…
    local de=$(detect_desktop_environment)
    if [ "$de" = "kde" ]; then
        deps+=("kdialog")
    else
        deps+=("zenity")
    fi
    
    for dep in "${deps[@]}"; do
        if command -v $dep &> /dev/null; then
            print_status "success" "$dep ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½"
        else
            print_status "warning" "$dep Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ - Ğ±ÑƒĞ´ĞµÑ‚ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½"
            missing+=("$dep")
        fi
    done
    
    if [ ${#missing[@]} -gt 0 ]; then
        echo ""
        print_status "info" "Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ½ĞµĞ´Ğ¾ÑÑ‚Ğ°ÑÑ‰Ğ¸Ñ… Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹..."
        sudo apt install -y "${missing[@]}" &>> "$LOG_FILE"
        print_status "success" "Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹"
    fi
    
    echo ""
}

check_system() {
    section_divider "Ğ˜ĞĞ¤ĞĞ ĞœĞĞ¦Ğ˜Ğ¯ Ğ Ğ¡Ğ˜Ğ¡Ğ¢Ğ•ĞœĞ•"
    
    # ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ DE
    local de=$(detect_desktop_environment)
    
    case $de in
        "kde")
            print_status "info" "Desktop: KDE Plasma"
            if command -v plasmashell &> /dev/null; then
                local plasma_ver=$(plasmashell --version 2>/dev/null | head -1)
                print_status "info" "Plasma: ${plasma_ver}"
            fi
            ;;
        "gnome")
            print_status "info" "Desktop: GNOME"
            if command -v gnome-shell &> /dev/null; then
                local gnome_ver=$(gnome-shell --version 2>/dev/null)
                print_status "info" "${gnome_ver}"
            fi
            ;;
        *)
            print_status "warning" "Desktop: ${de} (Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°Ñ‚ÑŒÑÑ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑÑ‚ÑŒÑ)"
            ;;
    esac
    
    print_status "info" "Kernel: $(uname -r)"
    
    if [ -f /etc/os-release ]; then
        source /etc/os-release
        print_status "info" "OS: ${PRETTY_NAME}"
    fi
    
    echo ""
    sleep 1
}

download_and_set_wallpaper() {
    section_divider "Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ ĞĞ‘ĞĞ•Ğ’"
    
    local de=$(detect_desktop_environment)
    print_status "info" "ĞĞ±Ğ½Ğ°Ñ€ÑƒĞ¶ĞµĞ½Ğ¾ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ğµ: ${de^^}"
    
    print_status "task" "Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¾Ğ±Ğ¾ĞµĞ² Ñ Google Drive..."
    print_status "command" "curl -L \"$WALLPAPER_URL\" -o \"$WALLPAPER_FILE\""
    
    # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ´Ğ¸Ñ€ĞµĞºÑ‚Ğ¾Ñ€Ğ¸Ñ
    mkdir -p "$WALLPAPER_DIR"
    
    echo ""
    
    # Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ĞµĞ¼ Ğ¾Ğ±Ğ¾Ğ¸ Ñ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ-Ğ±Ğ°Ñ€Ğ¾Ğ¼
    curl -L "$WALLPAPER_URL" -o "$WALLPAPER_FILE" \
        --progress-bar \
        --connect-timeout 30 \
        --max-time 120 2>&1 | \
        while IFS= read -r line; do
            echo -ne "\r    ${CYAN}${DOWNLOAD}${NC} Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°... $line"
        done
    
    echo ""
    echo ""
    
    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾ÑÑ‚ÑŒ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸
    if [ -f "$WALLPAPER_FILE" ] && [ -s "$WALLPAPER_FILE" ]; then
        local filesize=$(du -h "$WALLPAPER_FILE" | cut -f1)
        print_status "success" "ĞĞ±Ğ¾Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ñ‹: $WALLPAPER_FILE ($filesize)"
        
        # Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµĞ¼ Ğ¾Ğ±Ğ¾Ğ¸ Ğ² Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ¾Ñ‚ DE
        case $de in
            "kde")
                set_wallpaper_kde "$WALLPAPER_FILE"
                ;;
            "gnome")
                set_wallpaper_gnome "$WALLPAPER_FILE"
                ;;
            *)
                print_status "warning" "ĞĞ²Ñ‚Ğ¾ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¾Ğ±Ğ¾ĞµĞ² Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ Ğ´Ğ»Ñ $de"
                print_status "info" "ĞĞ±Ğ¾Ğ¸ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ñ‹: $WALLPAPER_FILE"
                print_status "info" "Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚Ğµ Ğ¸Ñ… Ğ²Ñ€ÑƒÑ‡Ğ½ÑƒÑ Ñ‡ĞµÑ€ĞµĞ· Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‡ĞµĞ³Ğ¾ ÑÑ‚Ğ¾Ğ»Ğ°"
                ;;
        esac
    else
        print_status "error" "ĞÑˆĞ¸Ğ±ĞºĞ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ¸ Ğ¾Ğ±Ğ¾ĞµĞ²!"
        return 1
    fi
    
    echo ""
    sleep 1
}

execute_command() {
    local step_num=$1
    local total_steps=$2
    local description="$3"
    local command="$4"
    local auto_input="$5"
    
    echo ""
    echo -e "${CYAN}    â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®${NC}"
    echo -e "${CYAN}    â”‚${NC} ${BOLD}${WHITE}STEP ${step_num}/${total_steps}${NC} ${GRAY}â”‚${NC} ${YELLOW}${description}${NC}"
    echo -e "${CYAN}    â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯${NC}"
    
    print_status "command" "$command"
    echo ""
    
    echo -e "    ${GRAY}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ OUTPUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
    echo ""
    
    if [ -n "$auto_input" ]; then
        echo "$auto_input" | eval "$command" 2>&1 | while IFS= read -r line; do
            echo -e "    ${GRAY}â”‚${NC} $line"
        done
    else
        eval "$command" 2>&1 | while IFS= read -r line; do
            echo -e "    ${GRAY}â”‚${NC} $line"
        done
    fi
    
    local exit_code=${PIPESTATUS[0]}
    
    echo ""
    echo -e "    ${GRAY}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
    
    if [ $exit_code -eq 0 ]; then
        print_status "success" "ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ° ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾!"
        return 0
    else
        print_status "error" "ĞšĞ¾Ğ¼Ğ°Ğ½Ğ´Ğ° Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»Ğ°ÑÑŒ Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¾Ğ¹ (ĞºĞ¾Ğ´: $exit_code)"
        return 1
    fi
}

run_with_kdialog_progress() {
    local dbusRef=$(kdialog --progressbar "Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ..." 7 --title "ğŸš€ Beautifulconfig v${VERSION}")
    
    qdbus $dbusRef Set "" value 0
    qdbus $dbusRef setLabelText "[1/7] ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ SPI..."
    sudo spi repo-update >> "$LOG_FILE" 2>&1
    
    qdbus $dbusRef Set "" value 1
    qdbus $dbusRef setLabelText "[2/7] Ğ—Ğ°Ğ¿ÑƒÑĞº SPI..."
    spi >> "$LOG_FILE" 2>&1
    
    qdbus $dbusRef Set "" value 2
    qdbus $dbusRef setLabelText "[3/7] ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ² SPI..."
    sudo spi update >> "$LOG_FILE" 2>&1
    
    qdbus $dbusRef Set "" value 3
    qdbus $dbusRef setLabelText "[4/7] ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²..."
    sudo apt update >> "$LOG_FILE" 2>&1
    sudo apt upgrade -y >> "$LOG_FILE" 2>&1
    
    qdbus $dbusRef Set "" value 4
    qdbus $dbusRef setLabelText "[5/7] Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Telegram..."
    echo "2" | sudo spi install --flatpak telegram >> "$LOG_FILE" 2>&1
    
    qdbus $dbusRef Set "" value 5
    qdbus $dbusRef setLabelText "[6/7] Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Baldi..."
    sudo spi install --spi baldi >> "$LOG_FILE" 2>&1
    
    qdbus $dbusRef Set "" value 6
    qdbus $dbusRef setLabelText "[7/7] Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Chrome..."
    sudo spi install --spi chrome >> "$LOG_FILE" 2>&1
    
    qdbus $dbusRef Set "" value 7
    qdbus $dbusRef setLabelText "Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!"
    sleep 1
    qdbus $dbusRef close
    
    return 0
}

run_with_zenity_progress() {
    (
        echo "0"
        echo "# Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ..."
        sleep 1
        
        echo "14"
        echo "# [1/7] ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ SPI..."
        sudo spi repo-update >> "$LOG_FILE" 2>&1
        
        echo "28"
        echo "# [2/7] Ğ—Ğ°Ğ¿ÑƒÑĞº SPI..."
        spi >> "$LOG_FILE" 2>&1
        
        echo "42"
        echo "# [3/7] ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ² SPI..."
        sudo spi update >> "$LOG_FILE" 2>&1
        
        echo "56"
        echo "# [4/7] ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²..."
        sudo apt update >> "$LOG_FILE" 2>&1
        sudo apt upgrade -y >> "$LOG_FILE" 2>&1
        
        echo "70"
        echo "# [5/7] Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Telegram..."
        echo "2" | sudo spi install --flatpak telegram >> "$LOG_FILE" 2>&1
        
        echo "84"
        echo "# [6/7] Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Baldi..."
        sudo spi install --spi baldi >> "$LOG_FILE" 2>&1
        
        echo "98"
        echo "# [7/7] Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Chrome..."
        sudo spi install --spi chrome >> "$LOG_FILE" 2>&1
        
        echo "100"
        echo "# Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾!"
        
    ) | zenity --progress \
        --title="ğŸš€ Beautifulconfig v${VERSION}" \
        --text="ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²ĞºĞ°..." \
        --percentage=0 \
        --auto-close \
        --width=500 \
        --no-cancel
    
    return $?
}

run_installation_terminal() {
    section_divider "Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ˜Ğ• ĞšĞĞœĞĞĞ”"
    
    local total=7
    local current=0
    local failed=0
    
    declare -a commands=(
        "ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ SPI|sudo spi repo-update|"
        "Ğ—Ğ°Ğ¿ÑƒÑĞº SPI|spi|"
        "ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ² SPI|sudo spi update|"
        "ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ñ… Ğ¿Ğ°ĞºĞµÑ‚Ğ¾Ğ²|sudo apt update && sudo apt upgrade -y|"
        "Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Telegram (Flatpak)|sudo spi install --flatpak telegram|2"
        "Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Baldi|sudo spi install --spi baldi|"
        "Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Chrome|sudo spi install --spi chrome|"
    )
    
    for cmd_entry in "${commands[@]}"; do
        IFS='|' read -r description command auto_input <<< "$cmd_entry"
        current=$((current + 1))
        
        terminal_progress_bar $current $total "$description"
        echo ""
        
        if execute_command $current $total "$description" "$command" "$auto_input"; then
            print_status "success" "Ğ¨Ğ°Ğ³ $current/$total Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½"
        else
            print_status "error" "Ğ¨Ğ°Ğ³ $current/$total Ğ¿Ñ€Ğ¾Ğ²Ğ°Ğ»ĞµĞ½"
            failed=$((failed + 1))
        fi
        
        sleep 1
    done
    
    return $failed
}

show_final_report() {
    local failed=$1
    
    echo ""
    echo ""
    
    if [ $failed -eq 0 ]; then
        echo -e "${GREEN}${BOLD}"
        cat << 'EOF'
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘                                                                   â•‘
    â•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â•‘
    â•‘     â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•     â•‘
    â•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â•‘
    â•‘     â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â–ˆâ–ˆâ•‘â•šâ•â•â•â•â–ˆâ–ˆâ•‘     â•‘
    â•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘     â•‘
    â•‘     â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•     â•‘
    â•‘                                                                   â•‘
    â•‘               âœ… Ğ’Ğ¡Ğ• Ğ—ĞĞ”ĞĞ§Ğ˜ Ğ’Ğ«ĞŸĞĞ›ĞĞ•ĞĞ« Ğ£Ğ¡ĞŸĞ•Ğ¨ĞĞ!                    â•‘
    â•‘                                                                   â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EOF
        echo -e "${NC}"
    else
        echo -e "${YELLOW}${BOLD}"
        cat << 'EOF'
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘          âš ï¸  Ğ£Ğ¡Ğ¢ĞĞĞĞ’ĞšĞ Ğ—ĞĞ’Ğ•Ğ Ğ¨Ğ•ĞĞ Ğ¡ ĞŸĞ Ğ•Ğ”Ğ£ĞŸĞ Ğ•Ğ–Ğ”Ğ•ĞĞ˜Ğ¯ĞœĞ˜               â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EOF
        echo -e "${NC}"
        print_status "warning" "ĞĞµĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ğ»Ğ¸ÑÑŒ Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°Ğ¼Ğ¸: $failed"
    fi
    
    echo ""
    echo -e "    ${GRAY}â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®${NC}"
    echo -e "    ${GRAY}â”‚${NC} ${INFO}  Ğ›Ğ¾Ğ³: ${CYAN}${LOG_FILE}${NC}"
    echo -e "    ${GRAY}â”‚${NC} ${ROCKET} Ğ’ĞµÑ€ÑĞ¸Ñ: ${CYAN}Beautifulconfig v${VERSION}${NC}"
    echo -e "    ${GRAY}â”‚${NC} ${STAR}  ĞĞ²Ñ‚Ğ¾Ñ€: ${CYAN}${AUTHOR} Â© ${YEAR}${NC}"
    echo -e "    ${GRAY}â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯${NC}"
    echo ""
}

select_mode() {
    section_divider "Ğ’Ğ«Ğ‘ĞĞ  Ğ Ğ•Ğ–Ğ˜ĞœĞ Ğ ĞĞ‘ĞĞ¢Ğ«"
    
    local de=$(detect_desktop_environment)
    local gui_name="Zenity"
    [ "$de" = "kde" ] && gui_name="KDialog"
    
    echo -e "    ${WHITE}${BOLD}Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ€ĞµĞ¶Ğ¸Ğ¼ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ¸:${NC}"
    echo ""
    echo -e "    ${CYAN}[1]${NC} ${WHITE}ğŸ–¥ï¸  Ğ¢ĞµÑ€Ğ¼Ğ¸Ğ½Ğ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼${NC}"
    echo -e "        ${GRAY}ĞŸĞ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ñ‹Ğ¹ Ğ²Ñ‹Ğ²Ğ¾Ğ´ ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´ Ñ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ-Ğ±Ğ°Ñ€Ğ¾Ğ¼${NC}"
    echo ""
    echo -e "    ${CYAN}[2]${NC} ${WHITE}ğŸªŸ  GUI Ñ€ĞµĞ¶Ğ¸Ğ¼ (${gui_name})${NC}"
    echo -e "        ${GRAY}Ğ“Ñ€Ğ°Ñ„Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ-Ğ±Ğ°Ñ€${NC}"
    echo ""
    echo -e "    ${CYAN}[3]${NC} ${WHITE}ğŸ¨  Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¾Ğ±Ğ¾Ğ¸${NC}"
    echo -e "        ${GRAY}Ğ¢Ğ¾Ğ»ÑŒĞºĞ¾ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¾Ğ±Ğ¾ĞµĞ²${NC}"
    echo ""
    echo -e "    ${CYAN}[0]${NC} ${WHITE}âŒ  Ğ’Ñ‹Ñ…Ğ¾Ğ´${NC}"
    echo ""
    
    read -p "    Ğ’Ğ°Ñˆ Ğ²Ñ‹Ğ±Ğ¾Ñ€ [1-3, 0]: " mode_choice
    echo ""
    
    case $mode_choice in
        1) return 1 ;;
        2) return 2 ;;
        3) return 3 ;;
        0) return 0 ;;
        *) return 1 ;;
    esac
}

confirm_start() {
    echo ""
    echo -e "    ${YELLOW}${BOLD}âš ï¸  Ğ’ĞĞ˜ĞœĞĞĞ˜Ğ•${NC}"
    echo -e "    ${WHITE}Ğ‘ÑƒĞ´ÑƒÑ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹ ÑĞ»ĞµĞ´ÑƒÑÑ‰Ğ¸Ğµ Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ:${NC}"
    echo ""
    echo -e "    ${GRAY}1.${NC} Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ¾Ğ±Ğ¾ĞµĞ²"
    echo -e "    ${GRAY}2.${NC} sudo spi repo-update"
    echo -e "    ${GRAY}3.${NC} spi"
    echo -e "    ${GRAY}4.${NC} sudo spi update"
    echo -e "    ${GRAY}5.${NC} sudo apt update && sudo apt upgrade -y"
    echo -e "    ${GRAY}6.${NC} sudo spi install --flatpak telegram (Ğ²Ñ‹Ğ±Ğ¾Ñ€ 2)"
    echo -e "    ${GRAY}7.${NC} sudo spi install --spi baldi"
    echo -e "    ${GRAY}8.${NC} sudo spi install --spi chrome"
    echo ""
    
    read -p "    ĞŸÑ€Ğ¾Ğ´Ğ¾Ğ»Ğ¶Ğ¸Ñ‚ÑŒ? [Y/n]: " confirm
    
    case $confirm in
        [Nn]*) return 1 ;;
        *) return 0 ;;
    esac
}

#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
# Ğ“Ğ›ĞĞ’ĞĞĞ¯ Ğ¤Ğ£ĞĞšĞ¦Ğ˜Ğ¯
#â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

main() {
    echo "=== Beautifulconfig v${VERSION} by ${AUTHOR} ===" > "$LOG_FILE"
    echo "Started: $(date)" >> "$LOG_FILE"
    echo "User: $USER" >> "$LOG_FILE"
    echo "Desktop: $(detect_desktop_environment)" >> "$LOG_FILE"
    echo "========================================" >> "$LOG_FILE"
    
    show_banner
    animated_line
    
    check_system
    check_dependencies
    
    select_mode
    local mode=$?
    
    local de=$(detect_desktop_environment)
    
    case $mode in
        0)
            print_status "info" "Ğ’Ñ‹Ñ…Ğ¾Ğ´ Ğ¸Ğ· Ğ¿Ñ€Ğ¾Ğ³Ñ€Ğ°Ğ¼Ğ¼Ñ‹..."
            exit 0
            ;;
        1)
            if confirm_start; then
                download_and_set_wallpaper
                run_installation_terminal
                show_final_report $?
            else
                print_status "info" "ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ°"
            fi
            ;;
        2)
            if confirm_start; then
                download_and_set_wallpaper
                
                if [ "$de" = "kde" ] && command -v kdialog &> /dev/null; then
                    run_with_kdialog_progress
                    kdialog --msgbox "Ğ’ÑĞµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹!\n\nĞĞ²Ñ‚Ğ¾Ñ€: ${AUTHOR}\nĞ›Ğ¾Ğ³: $LOG_FILE" --title "âœ… Ğ£ÑĞ¿ĞµÑ…!"
                else
                    run_with_zenity_progress
                    zenity --info --title="âœ… Ğ£ÑĞ¿ĞµÑ…!" --text="Ğ’ÑĞµ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ñ‹!\n\nĞĞ²Ñ‚Ğ¾Ñ€: ${AUTHOR}\nĞ›Ğ¾Ğ³: $LOG_FILE" --width=400
                fi
                
                show_final_report 0
            else
                print_status "info" "ĞĞ¿ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¾Ñ‚Ğ¼ĞµĞ½ĞµĞ½Ğ°"
            fi
            ;;
        3)
            download_and_set_wallpaper
            show_final_report 0
            ;;
    esac
    
    echo "" >> "$LOG_FILE"
    echo "Finished: $(date)" >> "$LOG_FILE"
    
    echo ""
    echo -e "    ${PURPLE}${BOLD}Ğ¡Ğ¿Ğ°ÑĞ¸Ğ±Ğ¾ Ğ·Ğ° Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Beautifulconfig!${NC}"
    echo -e "    ${GRAY}Created by ${AUTHOR} Â© ${YEAR}${NC}"
    echo -e "    ${GRAY}Press any key to exit...${NC}"
    read -n 1 -s
}

main "$@"
